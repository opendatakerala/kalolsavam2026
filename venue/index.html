<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 തൃശ്ശൂർ കലോത്സവവേദി ഭൂപടം</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .header {
            width: 100%;
            height: 150px;
            background-image: url('https://ulsavam.kite.kerala.gov.in/2025/kalolsavam/images/template_login_top_bg_2022.jpg');
            background-size: cover;
            background-position: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .header {
                height: 80px;
            }
        }

        .title-bar {
            background: white;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .title-bar h1 {
            color: #667eea;
            font-size: 24px;
            margin-bottom: 5px;
        }

        .title-bar p {
            color: #666;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .title-bar {
                padding: 10px;
            }
            
            .title-bar h1 {
                font-size: 16px;
            }
            
            .title-bar p {
                font-size: 12px;
            }
        }

        .map-container {
            overflow: hidden;
        }

        .venues-panel {
            width: 400px;
            height: calc(100vh - 220px);
            min-height: 400px;
            float: left;
            background: white;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .venues-panel {
                display: none;
            }
        }

        .venues-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .venue-item {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .venue-item:hover {
            background: #f8f9ff;
        }

        .venue-item.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .venue-item.selected .venue-item-number {
            background: white;
            color: #667eea;
        }

        .venue-item.selected .venue-item-name {
            color: white;
        }

        .venue-item.selected .venue-item-place {
            color: rgba(255, 255, 255, 0.9);
        }

        .venue-item-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 16px;
            flex-shrink: 0;
        }

        .venue-item-content {
            flex: 1;
        }

        .venue-item-name {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .venue-item-place {
            font-size: 12px;
            color: #666;
        }

        .panel-header {
            padding: 15px;
            background: #667eea;
            color: white;
            font-weight: 600;
            font-size: 14px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        #map {
            width: calc(100% - 400px);
            height: calc(100vh - 220px);
            min-height: 400px;
            float: right;
        }

        @media (max-width: 768px) {
            #map {
                width: 100%;
                height: calc(100vh - 150px);
                min-height: 300px;
                float: none;
            }
        }

        .custom-marker {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .marker-pin {
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 30px solid #667eea;
            position: relative;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .marker-pin::after {
            content: '';
            position: absolute;
            top: -30px;
            left: -6px;
            width: 12px;
            height: 12px;
            background: #667eea;
            border-radius: 50%;
            border: 2px solid white;
        }

        .marker-label {
            background: white;
            color: #667eea;
            padding: 4px 8px;
            font-weight: bold;
            font-size: 10px;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            margin-top: 2px;
            border: 1px solid #667eea;
        }

        .leaflet-popup-content-wrapper {
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
        }

        .leaflet-popup-tip {
            background: rgba(255, 255, 255, 0.2);
        }

        .popup-card {
            padding: 15px;
            min-width: 280px;
        }

        @media (max-width: 768px) {
            .popup-card {
                padding: 10px;
                min-width: 200px;
            }
        }

        .popup-header {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }

        @media (max-width: 768px) {
            .popup-header {
                margin-bottom: 10px;
                padding-bottom: 10px;
            }
        }

        .venue-name {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .venue-name {
                font-size: 16px;
            }
        }

        .venue-number {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .venue-number {
                font-size: 12px;
            }
        }

        .popup-details {
            display: grid;
            gap: 10px;
        }

        @media (max-width: 768px) {
            .popup-details {
                gap: 6px;
            }
        }

        .detail-row {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .detail-label {
            font-weight: 600;
            color: #667eea;
            min-width: 60px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .detail-label {
                font-size: 11px;
                min-width: 50px;
            }
        }

        .detail-value {
            color: #333;
            font-size: 14px;
            flex: 1;
        }

        @media (max-width: 768px) {
            .detail-value {
                font-size: 11px;
            }
        }

        .venue-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: bold;
            margin: 0 auto 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        @media (max-width: 768px) {
            .venue-icon {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="header"></div>
    
    <div class="title-bar">
        <h1>2026 തൃശ്ശൂർ കലോത്സവവേദി ഭൂപടം</h1>
        <p>Kerala State School Kalolsavam 2026 - Venue Map | Thrissur</p>
    </div>

    <div class="map-container">
        <div class="venues-panel">
            <div class="panel-header">വേദികൾ - Venues</div>
            <ul class="venues-list" id="venuesList">
            </ul>
        </div>
        <div id="map"></div>
    </div>

    <script>
        async function loadVenueData() {
            try {
                const csvData = await window.fs.readFile('mapkalothsavamtest.csv', { encoding: 'utf8' });
                
                const lines = csvData.trim().split('\n');
                const venues = [];
                
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (!line) continue;
                    
                    const values = line.split('\t');
                    if (values.length >= 5) {
                        const venueNumber = values[0]?.trim() || '';
                        const venueName = values[1]?.trim() || '';
                        const place = values[2]?.trim() || '';
                        const lat = parseFloat(values[3]?.trim());
                        const lng = parseFloat(values[4]?.trim());
                        
                        if (!isNaN(lat) && !isNaN(lng)) {
                            venues.push({
                                venueNumber,
                                venueName,
                                place,
                                location: [lat, lng]
                            });
                        }
                    }
                }
                
                return venues;
            } catch (error) {
                console.error('Error loading CSV:', error);
                // Fallback to hardcoded data if CSV fails
                return [
                    { venueNumber: "1", venueName: "സൂര്യകാന്തി", place: "തേക്കിൻ‌കാട് മൈതാനം (എക്സിബിഷൻ ഗ്രൗണ്ട്)", location: [10.525246, 76.2163376] },
                    { venueNumber: "2", venueName: "പാരിജാതം", place: "തേക്കിൻ‌കാട് മൈതാനം (CMS ന് മുൻവശം)", location: [10.525595, 76.2123779] },
                    { venueNumber: "3", venueName: "നീലക്കുറിഞ്ഞി", place: "തേക്കിൻ‌കാട് മൈതാനം (ബാനർജി ക്ലബ്ബിന് മുൻവശം)", location: [10.5270048, 76.2138102] },
                    { venueNumber: "4", venueName: "പവിഴമല്ലി", place: "ടൗൺഹാൾ തൃശ്ശൂർ", location: [10.5302025, 76.2188117] },
                    { venueNumber: "5", venueName: "ശംഖുപുഷ്പം", place: "വിവേകോദയം ബോയ്സ് എച്ച്.എസ്.എസ്.", location: [10.5285451, 76.210792] },
                    { venueNumber: "6", venueName: "ചെമ്പകം", place: "കേരളാബാങ്ക് ഹാൾ", location: [10.54135, 76.216063] },
                    { venueNumber: "7", venueName: "മന്ദാരം", place: "കേരള സാഹിത്യ അക്കാദമി ഓപ്പൺ സ്റ്റേജ്", location: [10.5291112, 76.2186489] },
                    { venueNumber: "8", venueName: "കനകാബരം", place: "കേരള സാഹിത്യ അക്കാദമി ഹാൾ", location: [10.5294896, 76.2183378] },
                    { venueNumber: "9", venueName: "ഗുൽമോഹർ", place: "സെന്റ് ജോസഫ്സ് സിജിഎച്ച്എസ്എസ്", location: [10.5131192, 76.2201614] },
                    { venueNumber: "10", venueName: "ചെമ്പരത്തി", place: "എം ടി എച്ച് എസ് ചേലക്കോട്ടുകര", location: [10.50735, 76.224882] },
                    { venueNumber: "11", venueName: "കർണികാരം", place: "കാൽഡിയൻ സിറിയൻ എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.518478, 76.218029] },
                    { venueNumber: "12", venueName: "നിത്യകല്യാണി", place: "എസ് എച്ച് സി ജി എച്ച് എസ് എസ് തൃശൂർ", location: [10.526163, 76.219376] },
                    { venueNumber: "13", venueName: "പനിനീർപ്പൂവ്", place: "ജവഹർ ബാലഭവൻ", location: [10.5322856, 76.2191585] },
                    { venueNumber: "14", venueName: "നന്ത്യാർവട്ടം", place: "ഹോളിഫാമിലി സി.ജി.എച്ച്.എസ്. ചെമ്പുക്കാവ്", location: [10.5319396, 76.2224547] },
                    { venueNumber: "15", venueName: "ഡാലിയ", place: "ഹോളിഫാമിലി സി.ജി.എച്ച്.എസ്. ചെമ്പുക്കാവ്", location: [10.53214, 76.222629] },
                    { venueNumber: "16", venueName: "വാടാമല്ലി", place: "സി എം എസ് എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.5252861, 76.2113821] },
                    { venueNumber: "17", venueName: "മുല്ലപ്പൂവ്", place: "സി എം എസ് എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.5251437, 76.2115591] },
                    { venueNumber: "18", venueName: "ആമ്പൽപ്പൂവ്", place: "ഗവ മോഡൽ ബോയ്സ് എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.5274965, 76.2192472] },
                    { venueNumber: "19", venueName: "തുമ്പപ്പൂവ്", place: "ഗവ മോഡൽ ബോയ്സ് എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.5274028, 76.2186947] },
                    { venueNumber: "20", venueName: "കണ്ണാന്തളി", place: "സെന്റ് ക്ലയേഴ്സ് എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.5275541, 76.2258875] },
                    { venueNumber: "21", venueName: "പിച്ചകപ്പൂവ്", place: "സെന്റ് തോമസ് കോളേജ് എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.5229397, 76.219559] },
                    { venueNumber: "22", venueName: "ജമന്തി", place: "സെന്റ് തോമസ് കോളേജ് എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.52309, 76.21939] },
                    { venueNumber: "23", venueName: "തെച്ചിപ്പൂവ്", place: "സെന്റ് തോമസ് കോളേജ് എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.5229186, 76.2193551] },
                    { venueNumber: "24", venueName: "താഴമ്പൂ", place: "സെന്റ് തോമസ് കോളേജ് എച്ച് എസ് എസ് തൃശ്ശൂർ", location: [10.5231269, 76.2195751] },
                    { venueNumber: "25", venueName: "ചെണ്ടുമല്ലി", place: "ഐ.എം. വിജയൻ സ്പോർട്സ് കോംപ്ലക്സ് ലാലൂർ", location: [10.515263, 76.186398] },
                    { venueNumber: "26", venueName: "രജിസ്ട്രേഷൻ", place: "ഗവൺമെന്റ് മോഡൽ ബോയ്സ് എച്ച്.എസ്.എസ്", location: [10.527656, 76.218464] },
                    { venueNumber: "27", venueName: "പ്രോഗ്രാം ഓഫീസ്", place: "ജി വി എച്ച് എസ് എസ് ഗേൾസ് തൃശ്ശൂർ", location: [10.5270902, 76.217443] },
                    { venueNumber: "28", venueName: "ഭക്ഷണശാല", place: "പാലസ് ഗ്രൗണ്ട്", location: [10.5318798, 76.2166643] }
                ];
            }
        }

        let map = L.map('map', {
            minZoom: 12,
            maxBounds: [[10.45, 76.15], [10.60, 76.28]],
            maxBoundsViscosity: 1.0
        }).setView([10.5276, 76.2144], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        let markers = [];

        function createPopupContent(venue) {
            return `
                <div class="popup-card">
                    <div class="venue-icon">${venue.venueNumber}</div>
                    <div class="popup-header">
                        <div class="venue-name">${venue.venueName}</div>
                        <div class="venue-number">(${venue.venueNumber})</div>
                    </div>
                    <div class="popup-details">
                        <div class="detail-row">
                            <span class="detail-label">സ്ഥലം:</span>
                            <span class="detail-value">${venue.place}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        async function initMap() {
            const venues = await loadVenueData();
            
            const venuesList = document.getElementById('venuesList');
            venuesList.innerHTML = '';
            
            let selectedIndex = null;
            
            venues.forEach((venue, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'venue-item';
                listItem.innerHTML = `
                    <div class="venue-item-number">${venue.venueNumber}</div>
                    <div class="venue-item-content">
                        <div class="venue-item-name">${venue.venueName}</div>
                        <div class="venue-item-place">${venue.place}</div>
                    </div>
                `;
                
                listItem.addEventListener('click', () => {
                    // Remove previous selection
                    if (selectedIndex !== null) {
                        venuesList.children[selectedIndex].classList.remove('selected');
                    }
                    
                    // Add new selection
                    listItem.classList.add('selected');
                    selectedIndex = index;
                    
                    // Zoom to venue and open popup
                    map.setView(venue.location, 16);
                    markers[index].openPopup();
                });
                
                venuesList.appendChild(listItem);
                
                const marker = L.marker(venue.location, {
                    icon: L.divIcon({
                        className: 'custom-marker-container',
                        html: `<div class="custom-marker">
                                <div class="marker-pin"></div>
                                <div class="marker-label">${venue.venueName}</div>
                               </div>`,
                        iconSize: [200, 50],
                        iconAnchor: [100, 50]
                    })
                }).addTo(map);

                marker.bindPopup(createPopupContent(venue), {
                    maxWidth: 350
                });
                
                marker.on('click', () => {
                    // Remove previous selection
                    if (selectedIndex !== null) {
                        venuesList.children[selectedIndex].classList.remove('selected');
                    }
                    
                    // Add new selection
                    listItem.classList.add('selected');
                    selectedIndex = index;
                    
                    // Scroll to item in list
                    listItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                });

                markers.push(marker);
            });

            if (venues.length > 0) {
                const bounds = L.latLngBounds(venues.map(v => v.location));
                map.fitBounds(bounds, { padding: [50, 50] });
            }
        }

        initMap();
    </script>
</body>
</html>
